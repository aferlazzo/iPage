<?php

header("HTTP/1.0 403 Forbidden");

function SendMessage($Subject, $Message)
{
	$IPaddr = GetIP();
	$text = $Message;
	$html = '<html><body>'.nl2br($Message).'</body></html>';
	$crlf = "\n";

	$To = "prontocommercial";
	$To .= "@gmail.com";
		// the email address of the person receiving the email
	$From = addslashes("Web Surfer")."<anthony@prontocommercial.com>";
	$SendDate = date('r');

	$To = $To.", ".$cc;
	$hdrs = array('From'    => $From,
					'Subject'  => $Subject,
					'To'       => $To,
					'bcc'      => $bcc,
					'Date'     => $SendDate);

	$mime = new Mail_mime();

	$mime->setTXTBody($text);
	$mime->setHTMLBody($html);

	$body = $mime->get();
	$hdrs = $mime->headers($hdrs);
	$Params["host"] = "mail.prontocommercial.com";
	$Params["port"] = "2626";
	$Params["auth"] = true;
	$Params["username"] = "anthony@prontocommercial.com";
	$Params["password"] = "1commguru";
	$Params["debug"] = false;

	$smtp = &Mail::factory("smtp", $Params);
	$SendError = $smtp->send($To, $hdrs, $body);

	if (PEAR::isError($SendError))
		die($SendError->getMessage());

	if ($Params["debug"] == true)
	{
		print("<br>From: |".$hdrs['From']."|<br>");
		print("Subject: |".$hdrs['Subject']."|<br>");
		print("To: |".$hdrs['To']."|<br>");

		print("host: |".$Params['host']."|<br>");
		print("port: |".$Params['port']."|<br>");
		print("username: |".$Params['username']."|<br>");
		print("msg text: |".$text."|<br>");
	}
}

//~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ -   \\
//                              \\
// Get the visitor's IP Address \\
//                              \\
//~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ -   \\

function GetIP()
{
if ($_SERVER)
{
	if ( $_SERVER[HTTP_X_FORWARDED_FOR] )
	{
	$realip = $_SERVER["HTTP_X_FORWARDED_FOR"];
	}
	elseif ( $_SERVER["HTTP_CLIENT_IP"] )
	{
	$realip = $_SERVER["HTTP_CLIENT_IP"];
	}
	else
	{
	$realip = $_SERVER["REMOTE_ADDR"];
	}
}
else
{
	if ( getenv( 'HTTP_X_FORWARDED_FOR' ) )
	{
	$realip = getenv( 'HTTP_X_FORWARDED_FOR' );
	}
	elseif ( getenv( 'HTTP_CLIENT_IP' ) )
	{
	$realip = getenv( 'HTTP_CLIENT_IP' );
	}
	else
	{
	$realip = getenv( 'REMOTE_ADDR' );
	}
}

return $realip;
}

// ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~  \\
//                                                                      \\
// A. The IncludePathFileExists() Function to check for existence of    \\
// php page.                                                            \\
//                                                                      \\
// This is a generic function that steps "B" and "C" use to check       \\
// whether newp ages exist for non-existent requested pages .           \\
//                                                                      \\
// ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~  \\

function IncludePathFileExists($OldPath)
{
	$Paths = explode(":", ini_get("include_path")); // get the server's configuration option "include_path"
	$Result = false;

	while( (!($Result)) && (list($Key,$Value) = each($Paths)) )
	{
		$Result = file_exists($Value . "/" . $OldPath);
	}

	return $Result;
}



$IPaddr = GetIP();
//print("Referrer name 2: ". $_SERVER['REQUEST_URI']);

if ($_SERVER['REQUEST_URI'] != "/404.php")
{
	$s=$_SERVER['REQUEST_URI'];
	$s=ereg_replace("&","|",$s);
	$raw=$s=ereg_replace("\?","|",$s);
	$Start = 3 + strpos($s,"|q=");
	if ($Start < 4)   //if not found
	{
		$raw="'q=' not found in |".$s."|";
		$Start = 3 + strpos($s,"|p=");  //try this for a Yahoo search
	}
	else
		$raw="'q=' found in |".$s."| at position ".$Start;
	$s=substr($s,$Start);
	$End=strpos($s,"|");

	if ($End > 0)
		$Searched=substr($s, 0, $End);
	else
		$Searched=$s;
	$Searched=eregi_replace("\+"," ",$Searched);
	$Searched=eregi_replace("%20"," ",$Searched);
	$Searched=eregi_replace("%25","%",$Searched);
	$Searched=eregi_replace("%3F","?",$Searched);

	$s=substr($_SERVER['REQUEST_URI'],7);
	$x = strpos($s,"/");
	if($x > 0)
		$SearchEngine = substr($s, 0, $x);
	else
		$SearchEngine = $s;
	$Message = "<p>Search Engine (Referrer): '$SearchEngine', Search Term: '$Searched'</p>\n";
	//die("Testing |$Message|");

	$Message .= "</p><p>(message generated by '".$_SERVER['PHP_SELF']."')</p>.";
}


// ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ - - - -    \\
//                                                                      \\
// If the new page wasn't found, we'll have to get input from the       \\
// visitor. The rest of the page is just a nicely done (if I do say so  \\
// myself) 404 Page Not Found error.                                    \\
//                                                                      \\
// ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ - - - -    \\

	$Message = "<p>A request for page |".$_SERVER['REQUEST_URI']."| was unfilled because you aren't allowed to go there.</p>";
	$Message .= "<p>The visitor at IP address ".$IPaddr.", ".gethostbyaddr($IPaddr)." could not be redirected because there is no replacement page.</p>";

	if ($_SERVER['REQUEST_URI'] == "/403.php")
		$Message .= "<p>Had this been a real error, you would have been told to stay calm and update the 404 error handler.</p>";
	else
		$Message .= "<p>The error handler page, 403.php, doesn't have a redirect page for this page. Please investigate ASAP.</p>";

	$Message .= "<p>User agent: ".  $_SERVER['HTTP_USER_AGENT'] . "</p>\n";

	$Message .= "<p>host name: ".  gethostbyaddr($_SERVER['REMOTE_ADDR']) . "</p>\n";
	if ($_SERVER['REQUEST_URI'] != "")
		$Message .= "<p>Referrer name: ".  $_SERVER['REQUEST_URI'] . "</p>\n";

	$Message .= "<p>(message generated by '".$_SERVER['PHP_SELF']."')</p>\n.\n";
	$Subject = "Pronto Commercial: Error From IP ".$IPaddr." Unsuccessful Redirect of Web Page ".$_SERVER['REQUEST_URI'];

	//die("Subject: $Subject<br>Message: $Message");

	SendMessage($Subject, $Message);

?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
	<base href="http://www.prontocommercial.com" >
	<title>403 Error - Permission Denied</title>
	<link rel="SHORTCUT ICON" href=
	"http://www.prontocommercial.com/favicon.ico">
	<?php include("http://www.prontocommercial.com/include/Head.php"); ?>
	</head>

<body>
	<?php include("http://www.prontocommercial.com/include/top.php"); ?>

				<h1>Whoops!<br><br>That web page or directory is off limits...</h1>

				<p><br>Looks like you just might be messing around, so I won't hold it against you.
				</p><?php

				if ($_SERVER['REQUEST_URI'])
					print ("<p>You were sent here by: '".  $_SERVER['REQUEST_URI'] . "' and there's a slight problem because</p>");
				print ("<p><span style='font-weight: bold;'>\n");
				if ($_SERVER['REQUEST_URI'] == $_SERVER['PHP_SELF'])
					print("(Testing me out, are you?) ");
				else
					print("\"http://".$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI'].",\"</span> cannot be found.");
				?>

				<p><br>
				Actually, that page was so popular we had to rename it. The only other thing I can think of was that
				the name might just be misspelled. You wouldn't do that, would you? Anyway, click on one of the other
				choices on this page. Surely, you'll soon be on your way and forget about this little web page screw-up.</p>

				<p><br>
				Click on <a href="javascript:history.back()">RETURN</a> to
				return to the previous page.<br>&nbsp;</p>
<!--
<script type="text/javascript">
var GOOG_FIXURL_LANG = 'en';
var GOOG_FIXURL_SITE = 'http://www.example.com'
</script>
<script type="text/javascript"
src="http://linkhelp.clients.google.com/tbproxy/lh/wm/fixurl.js">
</script>
-->
<p><br>&nbsp;</p>
				<?php include("http://www.prontocommercial.com/include/bottom.php"); ?>
</body>
</html>
